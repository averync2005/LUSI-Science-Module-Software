h1. Comprehensive RPI Testing Instructions

*GOOD PRACTICE:* Always unplug the Raspberry Pi before removing the SD card to prevent data corruption.

----

h2. 1. Overview

The goal is to establish a reliable, headless (no monitor, keyboard, or mouse) Ethernet connection between a Windows computer and a Raspberry Pi 4 Model B, then use that connection to control and test the LUSI Science Module hardware remotely via SSH.

After setup, you can SSH into the Pi at a fixed IP address. Wi-Fi is not required, but you can optionally share your Windows machine's Wi-Fi to give the Pi temporary Internet access when needed (for installing packages, cloning repos, etc.).

||Device||Interface||Static IP||Purpose||
|Windows PC|Ethernet|192.168.137.1|SSH host and optional Internet gateway|
|Raspberry Pi 4B|eth0|192.168.137.2|SSH target and hardware controller|

----

h2. 2. One-Time Raspberry Pi Configuration

These steps only need to be done once per Raspberry Pi.

h3. 2.1 Flash Raspberry Pi OS

# Open *Raspberry Pi Imager* on your Windows computer. You can download it from [https://www.raspberrypi.com/software/].
# Under *Choose OS*, select: *Raspberry Pi OS with Desktop (64-bit)*.
# Under *Choose Storage*, select your microSD card.
# Press *Ctrl + Shift + X* to open the *Advanced Settings* menu.
# Configure the following:
|| Setting || Value ||
| SSH | Enabled |
| Hostname | lusiPI |
| Username | pi |
| Password | lusi |
| Wi-Fi | Leave all Wi-Fi fields blank |
# Click *Write* and wait for the write and verification to complete.
# Safely eject the SD card, then insert it into the Raspberry Pi.

h3. 2.2 Boot and Enable SSH

For this initial setup step, you need to temporarily connect the Pi to a monitor, keyboard, and mouse.

# Insert the SD card into the Pi, connect a monitor via micro-HDMI, plug in a USB keyboard and mouse, and power on the Pi.
# Wait for it to boot into the desktop.
# Open a terminal window. You can find it in the top menu bar, or right-click the desktop and select "Open Terminal".
# Run the following commands one at a time to enable the SSH service:

{code}
sudo systemctl enable ssh
sudo systemctl start ssh
sudo systemctl status ssh
{code}

# Confirm that the output of the last command shows *active (running)*. This means SSH is working and will start automatically on every future boot.

h3. 2.3 Assign a Static IP Address

You need to give the Pi a fixed IP address on its Ethernet port so the Windows computer can always find it at the same address.

||Field||Value||
|Address|192.168.137.2|
|Netmask|255.255.255.0 (/24)|
|Gateway|192.168.137.1|

Run these commands one at a time in the Pi's terminal:

{code}
sudo nmcli connection modify "Wired connection 1" ipv4.addresses "192.168.137.2/24"
sudo nmcli connection modify "Wired connection 1" ipv4.gateway "192.168.137.1"
sudo nmcli connection modify "Wired connection 1" ipv4.method manual
sudo nmcli connection up "Wired connection 1"
{code}

Reboot the Pi to apply the changes:

{code}
sudo reboot
{code}

After this reboot, you can disconnect the monitor, keyboard, and mouse. All future access will be over Ethernet via SSH.

----

h2. 3. Windows Ethernet Configuration

h3. 3.1 Assign a Static IP to the Ethernet Adapter

# Press *Win + R* on your keyboard, type {{ncpa.cpl}}, and press *Enter*. This opens the Network Connections window.
# Find the Ethernet adapter that is physically connected to the Pi. Right-click it and select *Properties*.
# In the list, click on *Internet Protocol Version 4 (TCP/IPv4)*, then click *Properties*.
# Select *Use the following IP address* and enter:

||Field||Value||
|IP address|192.168.137.1|
|Subnet mask|255.255.255.0|
|Default gateway|(leave blank)|
|DNS server|(leave blank)|

# Click *OK*, then close all dialog windows.
# If the Ethernet cable is already plugged in, unplug it and plug it back in to force the adapter to pick up the new settings.

----

h2. 4. Verifying SSH Connectivity

# Connect an Ethernet cable directly between the Pi and the Windows computer. No router or switch is needed.
# Wait approximately 20 seconds for the link lights on both the Pi's Ethernet port and the computer's Ethernet port to turn on and stabilize.
# Open a terminal on Windows (*Command Prompt*, *PowerShell*, or *Windows Terminal*).
# Test that the Pi is reachable by running:

{code}
ping 192.168.137.2
{code}

If you see replies (e.g., "Reply from 192.168.137.2: bytes=32 ..."), the link is active.

# Connect to the Pi via SSH:

{code}
ssh pi@192.168.137.2
{code}

When prompted, enter the password: {{lusi}}

# You should now see the Raspberry Pi command prompt:

{code}
pi@lusiPI:~ $
{code}

SSH access over Ethernet is now functional and independent of Wi-Fi. You can now run commands on the Pi remotely from your Windows machine.

----

h2. 5. Enabling Temporary Internet Access (Optional)

If you need to install packages, clone repositories, or run system updates on the Pi, you can temporarily share your Windows computer's Wi-Fi connection over the Ethernet cable.

h3. 5.1 Enable Internet Connection Sharing (Windows)

# Open Network Connections: press *Win + R*, type {{ncpa.cpl}}, and press *Enter*.
# Right-click your *Wi-Fi adapter* (not the Ethernet adapter), and select *Properties*.
# Go to the *Sharing* tab.
# Check the box that says *"Allow other network users to connect through this computer's Internet connection."*
# In the dropdown menu below, select your *Ethernet adapter* (the one connected to the Pi).
# Click *OK*.

Windows automatically configures the shared interface to use the 192.168.137.x subnet, which matches the static IPs already configured.

h3. 5.2 Add a Default Route on the Pi

While Internet Connection Sharing is active, tell the Pi to route its Internet traffic through the Windows PC:

{code}
sudo ip route add default via 192.168.137.1
{code}

Test connectivity:

{code}
ping -c 3 8.8.8.8
ping -c 3 github.com
{code}

If both commands return successful replies, the Pi has Internet access through the Windows PC.

h3. 5.3 Disable Internet Sharing When Done

# On Windows, go back to *Wi-Fi --> Properties --> Sharing* tab.
# Uncheck *"Allow other network users to connect..."*.
# Click *OK*.
# Reboot the Pi or reconnect the Ethernet cable.

SSH over Ethernet will continue to work normally after disabling Internet sharing.

----

h2. 6. Making the Connection Persistent

To ensure the Ethernet connection survives reboots on both sides:

* Keep the Windows Ethernet adapter at *192.168.137.1* (static). This setting persists unless you change it.
* The Pi's Ethernet interface (eth0) is already set to *192.168.137.2* (manual/static via nmcli). This persists across reboots.
* Ensure the default route persists on the Pi by verifying after a reboot:

{code}
ip route
{code}

Expected output:

{code}
default via 192.168.137.1 dev eth0
192.168.137.0/24 dev eth0 proto kernel scope link src 192.168.137.2
{code}

If the default route is missing after a reboot, re-add it:

{code}
sudo ip route add default via 192.168.137.1
{code}

----

h2. 7. Installing Dependencies

All of the following commands are run on the Raspberry Pi via SSH.

h3. 7.1 Update System Packages

{code}
sudo apt update && sudo apt upgrade -y
{code}

h3. 7.2 Install Python and Virtual Environment Tools

{code}
sudo apt install -y python3 python3-pip python3-venv
{code}

h3. 7.3 Clone the LUSI Science Module Repository

{code}
cd ~/Desktop
git clone https://github.com/averync2005/LUSI-Science-Module-Software.git LUSI-Science-Module
cd LUSI-Science-Module
{code}

This clones the {{main}} branch into {{~/Desktop/LUSI-Science-Module}}.

h3. 7.4 Set Up a Python Virtual Environment

A virtual environment keeps the project's Python packages separate from the system Python, preventing version conflicts.

{code}
python3 -m venv venv
source venv/bin/activate
{code}

After running {{source venv/bin/activate}}, your terminal prompt will change to show {{(venv)}} at the beginning. This means the virtual environment is active. You must activate it every time you open a new SSH session before running any LUSI scripts.

h3. 7.5 Install Required Python Libraries

*Hardware controller dependencies* (required for motor controller and mass sensor):

{code}
pip install RPi.GPIO
pip install pigpio
pip install git+https://github.com/tatobari/hx711py.git
{code}

{{pigpio}} provides hardware-timed PWM for the motor controller. The {{pigpio}} daemon must be running before launching the motor controller script (see section 8.1).

*Camera and serial port dependencies* (required for ELP camera and serial port scripts):

{code}
pip install opencv-python
pip install pyserial
{code}

h3. 7.6 Verify Installation

{code}
pip list
{code}

You should see {{RPi.GPIO}}, {{pigpio}}, {{hx711}}, {{opencv-python}}, and {{pyserial}} in the list.

h3. 7.7 (Optional) Save / Restore the Environment

Save the current environment to a file:

{code}
pip freeze > requirements.txt
{code}

Reinstall from that file later:

{code}
pip install -r requirements.txt
{code}

----

h2. 8. Testing the Motor Controller

The Motor Controller CLI controls 4 motors on the LUSI Science Module:

||Motor||Type||GPIO Pin (BCM)||Purpose||Control||
|1. Auger Motor|NEO 550 (via Spark MAX)|12|Digs soil|Speed 0-100%, forward only|
|2. Platform Motor|NEO 550 (via Spark MAX)|13|Raises/lowers the soil collection platform|Speed 0-100%, bidirectional (up/down)|
|3. Testing Chamber Lid|SM-S2309S servo|18|Rotates testing chamber lid|Angle 0-180°|
|4. Soil Dropper|SG92R micro servo|19|Rotates soil dropper lid|Angle 0-180°|

h3. 8.1 Running the Motor Controller

The motor controller uses {{pigpio}} for hardware-timed PWM. Start the pigpio daemon first (only needs to be done once per boot):

{code}
sudo pigpiod
{code}

Then make sure you are in the project root directory with the virtual environment activated:

{code}
cd ~/Desktop/LUSI-Science-Module
source venv/bin/activate
python Motor_Controller_CLI.py
{code}

The CLI will print available commands and a status table showing all 4 motors.

h3. 8.2 Motor Controller Commands

The command menu and motor list reprint before every {{>>}} prompt. Type a motor number (1-4) to select it directly, or type a utility command.

||Command||Action||
|{{1}} / {{2}} / {{3}} / {{4}}|Select a motor and set its speed or angle|
|{{off}}|Turn off a single motor (prompts for motor number)|
|{{stop}} or {{x}}|Stop ALL motors immediately|
|{{status}} or {{s}}|Show motor status|
|{{help}} or {{h}}|Reprint the command menu|
|{{q}}|Quit the program|

After typing a motor number:
* Motors 1 & 2 (NEO 550): prompts for a speed percentage (0-100%). Setting 0% turns the motor off.
* Motor 2 only: prompts for direction (up/down) before speed.
* Motors 3 & 4 (servos): prompts for an angle (0-180°). Setting 0° moves the servo to the 0° position (resets angle).

h3. 8.3 Testing Procedure

# Launch the CLI using the command above.
# Type {{1}} and press Enter. Enter speed {{50}}. The Auger motor should spin at 50% and the status table should show ON.
# Type {{1}} again. Enter speed {{0}}. The motor should stop and deactivate (status OFF).
# Type {{2}}. Enter direction {{up}}. Enter speed {{30}}. The Platform motor should start moving upward at 30%.
# Type {{2}}. Enter direction {{down}}. Enter speed {{30}}. The Platform motor should reverse direction.
# Type {{3}}. Enter angle {{90}}. The Chamber Lid servo should rotate to 90°.
# Type {{3}}. Enter angle {{0}}. The servo should move to 0° (angle resets, motor stays ON).
# Type {{4}}. Enter angle {{45}}. The Soil Dropper servo should rotate to 45°.
# Type {{off}}. Enter motor {{4}}. The Soil Dropper should deactivate.
# Type {{stop}} or {{x}}. All motors should stop and all statuses should reset to OFF.
# Type {{q}} to quit. The terminal should print "[INFO] All motors stopped. GPIO cleaned up safely."

----

h2. 9. Testing the Weight Sensor

The weight sensor script reads weight data from a load cell connected to the Pi through an HX711 amplifier board.

||Pin||GPIO (BCM)||Purpose||
|DT (Data)|27|Receives weight data from the HX711|
|SCK (Clock)|17|Sends timing pulses to the HX711|

h3. 9.1 Running the Weight Sensor

{code}
cd ~/Desktop/LUSI-Science-Module
source venv/bin/activate
python Weight_Sensor.py
{code}

h3. 9.2 Expected Behavior

# On startup, the script prints: "[INFO] Taring... Please remove all weight from the load cell."
# Make sure nothing is on the load cell at this point. The script automatically tares (zeroes) itself.
# After taring, it prints: "[INFO] Tare complete."
# The script then continuously prints the measured weight in grams once per second, for example: {{Weight: 0.00 g}}
# Place a known weight on the load cell and verify that the displayed value changes accordingly.
# Press *CTRL+C* to stop the script. It will print: "[INFO] Exiting... Program stopped." followed by "[INFO] GPIO cleaned up safely." and automatically clean up the GPIO pins.

----

h2. 10. Testing the Camera System

The camera system script combines live preview, camera scanning, and serial port listing into a single file.

h3. 10.1 Scan for Connected Cameras

Before launching live preview, check which camera indices are available:

{code}
cd ~/Desktop/LUSI-Science-Module
source venv/bin/activate
python Camera_System.py scan
{code}

Typical output:
* Index 0: Built-in webcam (if running on a laptop)
* Index 1+: External USB cameras (e.g., the ELP camera)

h3. 10.2 Live Camera Preview

Launch the live preview with the default settings:

{code}
python Camera_System.py
{code}

Or with custom options (use the index found in the scan step):

{code}
python Camera_System.py --index 0 --width 640 --height 480
{code}

For all available options:

{code}
python Camera_System.py --help
{code}

Hotkeys in the live preview window:
* *c* - Capture a photo (saved to captures/photos/)
* *r* - Start/stop video recording (saved to captures/videos/)
* *q* - Quit

h3. 10.3 List Serial Ports

Detects available serial ports and optionally probes for GNSS/NMEA devices:

{code}
python Camera_System.py ports
{code}

To also probe for GNSS signals:

{code}
python Camera_System.py ports --probe
{code}

----

h2. 11. Quick Reference

||Task||Command / Action||
|SSH into the Pi|{{ssh pi@192.168.137.2}} (password: {{lusi}})|
|Activate the virtual environment|{{cd ~/Desktop/LUSI-Science-Module && source venv/bin/activate}}|
|Run motor controller|{{python Motor_Controller_CLI.py}}|
|Run weight sensor|{{python Weight_Sensor.py}}|
|Live camera preview|{{python Camera_System.py}}|
|Scan for cameras|{{python Camera_System.py scan}}|
|List serial ports|{{python Camera_System.py ports}}|
|Check network config (Pi)|{{ip addr}} / {{ip route}}|
|Add route if Internet fails|{{sudo ip route add default via 192.168.137.1}}|
|Test connectivity (from Windows)|{{ping 192.168.137.2}}|
|Test connectivity (from Pi)|{{ping 192.168.137.1}}|
|Recover SSH timeout|Check cable and link lights. Confirm Windows IP = 192.168.137.1. Confirm Pi eth0 = 192.168.137.2. Reboot both devices if needed.|
